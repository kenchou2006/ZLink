{% extends 'shortener/base.html' %}

{% block content %}
<div class="dashboard-container">
    <div class="header">
        <h1>Cache Management</h1>
        <p>Manage Redis cache entries</p>
    </div>

    {% if messages %}
    <div class="messages">
        {% for message in messages %}
        <div class="alert {{ message.tags }}">
            {{ message }}
        </div>
        {% endfor %}
    </div>
    {% endif %}

    <div class="links-table-container">
        <div
            style="padding: 20px; border-bottom: 1px solid rgba(255,255,255,0.1); display: flex; justify-content: space-between; align-items: center;">
            <span>Total Keys found: <strong>{{ keys|length }}</strong></span>
            <form action="{% url 'clear_all_cache' %}" method="POST" onsubmit="return confirm('Clear ALL cache?');">
                {% csrf_token %}
                <button type="submit" class="delete-btn">Clear All</button>
            </form>
        </div>
        <table class="links-table">
            <thead>
                <tr>
                    <th>Key</th>
                    <th>Type</th>
                    <th>TTL (sec)</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody>
                {% for item in keys %}
                <tr>
                    <td style="font-family: monospace;">
                        <code class="bg-gray-100 text-gray-800 px-2 py-1 rounded text-sm"
                            title="{{ item.key }}">{{ item.display_key }}</code>
                    </td>
                    <td>{{ item.type }}</td>
                    <td>{{ item.ttl }}</td>
                    <td>
                        <form action="{% url 'delete_cache_key' %}" method="POST" style="display:inline;">
                            {% csrf_token %}
                            <input type="hidden" name="key" value="{{ item.key }}">
                            <button type="submit" class="delete-btn"
                                style="padding: 4px 10px; font-size: 0.8rem;">Delete</button>
                        </form>
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="4" style="text-align: center; padding: 20px; color: var(--text-muted);">
                        No cache keys found matching 'shortener:url:*'
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endblock %}
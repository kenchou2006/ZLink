{% extends 'shortener/base.html' %}

{% block title %}Dashboard - ZLink{% endblock %}

{% block content %}
<div class="dashboard-container">
    <div class="header">
        <h1>ZLink Dashboard</h1>
        <p>Create and manage your shortened links</p>
    </div>

    {% if messages %}
    <div class="messages">
        {% for message in messages %}
        <div class="alert {{ message.tags }}">
            {{ message }}
        </div>
        {% endfor %}
    </div>
    {% endif %}

    <div class="stats-grid">
        <div class="stat-card">
            <h3>Total Links</h3>
            <div class="stat-value">{{ links|length }}</div>
        </div>
        <div class="stat-card">
            <h3>Active User</h3>
            <div class="stat-value" style="font-size: 1.5rem;">{{ user.username }}</div>
        </div>
    </div>

    <div class="create-section">
        <form action="{% url 'create_link' %}" method="POST" class="create-form">
            {% csrf_token %}
            <input type="url"
                   name="original_url"
                   placeholder="Paste your long URL here..."
                   required
                   aria-label="Original URL">
            <input type="text"
                   name="custom_alias"
                   placeholder="Custom alias (optional)"
                   pattern="[a-zA-Z0-9-_]+"
                   title="Alphanumeric, dashes, or underscores only"
                   maxlength="15"
                   aria-label="Custom alias">
            <button type="submit">Shorten URL</button>
        </form>
    </div>

    <div class="links-table-container">
        {% if links %}
        <table class="links-table">
            <thead>
                <tr>
                    <th>Original URL</th>
                    <th>Short Link</th>
                    <th>Created</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for link in links %}
                <tr>
                    <td class="url-cell" title="{{ link.original_url }}">
                        {{ link.original_url|truncatechars:60 }}
                    </td>
                    <td>
                        <a href="{{ request.scheme }}://{{ request.get_host }}/{{ link.short_code }}"
                           target="_blank"
                           rel="noopener noreferrer"
                           class="short-link">
                            {{ link.short_code }}
                        </a>
                        <button class="copy-btn-small"
                                onclick="copyToClipboard('{{ request.scheme }}://{{ request.get_host }}/{{ link.short_code }}', this)"
                                aria-label="Copy short link">
                            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24"
                                fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                stroke-linejoin="round">
                                <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                                <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                            </svg>
                        </button>
                    </td>
                    <td style="color: var(--text-tertiary); font-size: 0.875rem;">
                        {{ link.created_at|timesince }} ago
                    </td>
                    <td>
                        <a href="{% url 'edit_link' link.id %}" class="action-btn edit-btn">
                            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                                <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                            </svg>
                            Edit
                        </a>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        {% else %}
        <div class="empty-state">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"
                      d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1" />
            </svg>
            <h3>No links yet</h3>
            <p>Create your first shortened link above</p>
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}
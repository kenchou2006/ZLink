{% extends 'shortener/settings.html' %}

{% block settings_title %}Cache Management{% endblock %}
{% block cache_active %}active{% endblock %}

{% block settings_content %}
<!-- Cache Panel -->
<div id="cache-panel" class="settings-panel active">
    <div class="settings-panel-header">
        <div>
            <h2>Cache Management</h2>
            <p class="settings-description">Monitor and manage Redis cache entries</p>
        </div>
        <form action="{% url 'clear_all_cache' %}" method="POST" onsubmit="return confirm('Clear all cache keys?\n\nThis will remove all cached URLs and may temporarily impact performance.');">
            {% csrf_token %}
            <button type="submit" class="delete-btn" style="padding: 0.625rem var(--space-lg);">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <polyline points="1 4 1 10 7 10"></polyline>
                    <polyline points="23 20 23 14 17 14"></polyline>
                    <path d="M20.49 9A9 9 0 0 0 5.64 5.64L1 10m22 4l-4.64 4.36A9 9 0 0 1 3.51 15"></path>
                </svg>
                Clear All Cache
            </button>
        </form>
    </div>

    <div class="stats-grid">
        <div class="stat-card">
            <h3>Total Cache Keys</h3>
            <div class="stat-value">{{ keys|length }}</div>
        </div>
        <div class="stat-card">
            <h3>Status</h3>
            <div class="stat-value" style="font-size: 1.5rem; color: {% if keys %}var(--success){% else %}var(--text-disabled){% endif %};">
                {% if keys %}Online{% else %}Empty{% endif %}
            </div>
        </div>
    </div>

    {% if keys %}
    <div class="links-table-container">
        <table class="links-table">
            <thead>
                <tr>
                    <th>Cache Key</th>
                    <th>Type</th>
                    <th>TTL (seconds)</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for item in keys %}
                <tr>
                    <td>
                        <code class="cache-key" title="{{ item.key }}">
                            {{ item.display_key }}
                        </code>
                    </td>
                    <td>
                        <span class="cache-type-badge">
                            {{ item.type }}
                        </span>
                    </td>
                    <td>
                        {% if item.ttl > 0 %}
                        <span class="ttl-active">{{ item.ttl }}s</span>
                        {% elif item.ttl == -1 %}
                        <span class="ttl-never">âˆž Never</span>
                        {% else %}
                        <span class="ttl-expired">Expired</span>
                        {% endif %}
                    </td>
                    <td>
                        <form action="{% url 'delete_cache_key' %}" method="POST" style="display:inline;">
                            {% csrf_token %}
                            <input type="hidden" name="key" value="{{ item.key }}">
                            <button type="submit" class="delete-btn"
                                onclick="return confirm('Delete cache key: {{ item.display_key }}?');">
                                Delete
                            </button>
                        </form>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% else %}
    <div class="empty-state">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"
                  d="M5 8h14M5 8a2 2 0 110-4h14a2 2 0 110 4M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8m-9 4h4" />
        </svg>
        <h3>No cache entries found</h3>
        <p>Cache keys will appear here when URLs are accessed</p>
    </div>
    {% endif %}
</div>
<!-- End Cache Panel -->
{% endblock %}

